| 版本 | 日期       | 作者   | 备注                                         |
| :--- | :--------- | :----- | :------------------------------------------- |
| V1.0 | 2025-08-29 | Gemini | 基于用户提供的原型图创建第一版PRD             |
| V1.1 | 2025-08-30 | Gemini | 根据Demo需求，将登录流程修改为模拟登录       |
| V1.2 | 2025-08-30 | Gemini | 增加自动登录和全局认证拦截器逻辑             |
| V1.3 | 2025-08-30 | Gemini | 将健康报告实现方式修改为WebView加载网页      |
| V1.4 | 2025-08-30 | Gemini | 更新技术栈与依赖包列表                       |

## 1. 项目概述

### 1.1. 项目背景
随着人们健康意识的提高和慢性病患者数量的增加，持续的院外健康监测和管理变得至关重要。本项目旨在开发一款面向患者（特别是术后康复和慢性病患者）的移动应用，通过记录健康数据、设定康复目标、提供健康宣教和连接智能设备，帮助患者更好地进行自我健康管理，并与医疗团队保持沟通。

### 1.2. 产品目标
* **核心目标:** 为患者提供一个便捷的工具，用于追踪和管理关键健康指标（如血压、心率、体重等）。
* **用户价值:** 帮助患者提高治疗依从性，达成康复目标，增强自我管理的效能感。
* **商业价值:** 打造一个连接患者与医疗服务的平台，为后续的在线问诊、随访管理、个性化康复方案等增值服务奠定基础。

### 1.3. 目标用户
* **核心用户:** 心血管疾病（如PCI术后）患者、高血压、糖尿病等需要长期监测和管理的慢性病患者。
* **次要用户:** 患者家属，他们可能需要帮助家人记录数据或查看健康报告。

---

## 2. 技术栈与依赖包建议

* **网络请求 (`dio`):** 用于处理所有HTTP API请求。
* **状态管理 (`flutter_riverpod`, `hooks_riverpod`, `flutter_hooks`):** 使用 Riverpod 结合 Hooks 进行状态管理，提供灵活、可组合且高效的状态解决方案。
* **数据模型 (`freezed`):** 用于生成不可变的数据类 (data classes)，简化模型定义、复制和序列化过程，提高代码的健壮性。
* **UI资源 (`flutter_svg`, `font_awesome_flutter`):** 用于显示SVG图标和字体图标。
* **图表展示 (`fl_chart`):** 用于实现血压、心率等数据的历史趋势图表。
* **本地存储 (`shared_preferences`):** 用于在本地快速读写用户的登录凭证(`authToken`)、基础设置等轻量级数据。
* **日期和时间格式化 (`intl`):** 用于将后端返回的时间戳或日期字符串格式化为用户友好的显示格式。
* **本地通知 (`flutter_local_notifications`):** 用于实现“用药提醒”功能。
* **权限管理 (`permission_handler`):** 在集成第三方健康数据（如华为运动健康）时，用于请求和检查相关权限。
* **网页/链接跳转 (`url_launcher`):** 用于打开外部链接，如“服务协议”、“隐私协议”。
* **网页视图 (`webview_flutter`):** 用于在App内加载和显示网页形式的健康报告。
* **分享 (`share_plus`):** 用于分享健康报告的网页链接。
* go_router 路由

---

## 3. 功能需求详述 (Features)

### 模块一：用户账户与认证 (User & Auth)

#### 1.1 用户登录与会话管理
* **用户故事:** 作为一个用户，我希望能快速登录，并且在登录状态不过期的情况下，下次打开App时能直接使用，无需重复登录。
* **功能描述:**
    1.  **App启动与自动登录流程:**
        * 每次App启动时，应首先检查本地存储 (`shared_preferences`) 中是否存在有效的 `authToken`。
        * 如果 `authToken` 存在，则直接跳转到应用首页（Dashboard），跳过登录页面。
        * 如果 `authToken` 不存在，则显示登录页面。
    2.  **一键登录 (Demo 模拟流程):**
        * **(Demo阶段)** 此版本为演示版本，登录流程将进行简化。
        * 在登录页，无需检测SIM卡手机号，直接显示【一键登录】按钮。
        * 用户点击【一键登录】按钮，App将直接模拟登录请求成功。
        * 登录成功后，服务器返回一个预设的合法 `authToken`，客户端必须将此 `authToken` 存入 `shared_preferences`。
    3.  **协议同意:**
        * 登录按钮下方必须有“我已阅读并同意《服务协议》和《隐私协议》”的勾选框。
        * 默认不勾选，用户必须勾选后才能执行登录操作。
        * 协议文本为可点击链接，点击后跳转至对应的静态网页。
* **API接口建议:**
    * `POST /auth/mock-login` (模拟一键登录)

#### 1.2 添加/签约新患者
* **用户故事:** 作为一个用户，我希望能为自己或家人建立一份完整的健康档案，以便App提供个性化的管理方案。
* **功能描述:**
    1.  **表单填写:**
        * 在首次登录或“就诊人管理”中，引导用户填写签约患者信息。
        * 表单字段包括：真实姓名(必填)、身份证号(必填)、性别(必填)、出生日期(必填)、联系电话(必填)、病案号(选填)、紧急联系人(选填)、紧急联系人电话(选填)。
    2.  **提交与结果:**
        * 点击【确定】按钮，对必填项进行校验，不通过则提示用户。
        * 校验通过后，将数据提交至服务器。
        * 提交成功后，跳转至“签约成功”页面，并提供一个【返回首页】的按钮。
* **API接口建议:**
    * `POST /patients` (创建新患者档案)

### 模块二：首页 (Dashboard)

#### 2.1 核心功能
* **用户故事:** 作为一个患者，我希望一打开App就能看到我最关心的健康数据、康复目标进度和相关的健康知识，以便快速了解我的整体健康状况。
* **功能描述:**
    1.  **健康数据概览:** 以卡片形式展示心率、血压、体重、步数等今日或最近的核心数据。
    2.  **我的康复目标:** 列表展示血压控制、胆固醇水平、运动目标、用药依从性等目标的设定值与当前状态。
    3.  **健康宣教:** 信息流形式推荐健康知识文章或视频，并标记完成状态。
* **API接口建议:**
    * `GET /patients/{patientId}/dashboard` (获取首页所有聚合数据)

### 模块三：健康数据详情与记录

#### 3.1 血压详情
* **用户故事:** 我希望能查看我的历史血压数据、变化趋势，并方便地手动记录新的血压值。
* **功能描述:**
    1.  **趋势图表:** 提供“近一周”、“近一月”、“全部”时间维度的血压（收缩压/舒张压）折线图。
    2.  **历史列表:** 按时间倒序展示每一次的血压记录。
    3.  **手动录入:** 提供悬浮“+”按钮，弹出自定义键盘模态框用于记录新的血压值。
* **API接口建议:**
    * `GET /patients/{patientId}/blood-pressure?range=week|month|all`
    * `POST /patients/{patientId}/blood-pressure` (新增血压记录)

### 模块四：个人中心 (My Profile)

#### 4.1 核心功能
* **用户故事:** 我希望有一个统一的入口，可以管理我的个人资料、绑定的设备、查看我的服务，以及进行App的相关设置。
* **功能描述:**
    * **用户信息区:** 显示用户头像和姓名。
    * **快捷功能:** 我的收藏、健康反馈。
    * **常用工具列表:** 就诊人管理、智能设备、我的服务、专项评估、用药提醒、个人设置、关于。

#### 4.2 智能设备管理
* **用户故事:** 我希望能将我的智能健康设备与App连接，实现健康数据的自动同步。
* **功能描述:**
    * 列出支持的第三方健康平台（如：华为运动健康）。
    * 提供【点击授权】按钮，调用第三方SDK拉起授权流程。
    * 授权成功后，状态变为【已授权】，并可进行解绑。

### 模块五：健康报告 (网页版)

#### 5.1 康复月报
* **用户故事:** 我希望定期收到一份专业的健康报告，总结我近期的健康状况和康复进展，并能方便地在App内查看，以及将链接分享给我的医生或家人。
* **功能描述:**
    1.  **报告获取与列表:** App从服务器获取该患者的健康报告列表，每项包含报告标题和专属网页URL。
    2.  **报告查看 (WebView):** 用户点击报告项后，App跳转到新页面，使用 `WebView` 组件加载并渲染对应的URL。
    3.  **报告分享:** 在WebView页面提供“分享”按钮，调用系统分享功能，分享当前报告的网页链接。
* **API接口建议:**
    * `GET /patients/{patientId}/reports`: 获取报告列表。
        * **返回数据示例:** `[{ "title": "PCI术后康复月报 (2025年9月)", "url": "https://example.com/report/123" }, ...]`

---

## 4. 非功能性需求

### 4.1 网络层需求
* **请求拦截器:** `dio` 实例需添加请求拦截器，在每个发出的请求头中自动附加 `authToken`。
* **响应拦截器 (认证处理):** `dio` 实例需添加响应拦截器，用于全局处理API响应。若服务器返回认证失败（如HTTP `401`），必须清除本地 `authToken` 并强制导航至登录页。

### 4.2 性能
* App冷启动时间应小于3秒。
* 页面切换、列表滚动的流畅度应达到60fps。
* API请求在网络正常情况下响应时间应小于1秒。

### 4.3 安全性
* 所有API请求必须使用HTTPS。
* 敏感信息（如身份证号）在传输和存储时必须加密。
* 本地存储的 `authToken` 需进行加密保护。

### 4.4 兼容性
* 兼容主流的iOS和Android系统版本 (如: iOS 12+, Android 6.0+)。
* 对不同尺寸和分辨率的手机屏幕进行适配。
